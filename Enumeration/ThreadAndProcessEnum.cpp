#include <iostream>
#include <Windows.h>
#include <stdio.h>
#include <TlHelp32.h>


int Error(const char* msg) {
    printf("%s (%u)", msg, GetLastError());
    return 1;
}

int main()
{
    HANDLE snap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
    if (snap == INVALID_HANDLE_VALUE)
        return Error("Error creating snapshot");
    
    PROCESSENTRY32 entry;
    entry.dwSize = sizeof(entry);

    if (!Process32First(snap, &entry))
        return Error("Error at Process32First");

    do {
        printf("PID: %6u | PPID: %6u | Threads: %3u | %ws\n", 
            entry.th32ProcessID, entry.th32ParentProcessID, entry.cntThreads, entry.szExeFile);
    } while (Process32Next(snap, &entry));

    CloseHandle(snap);
    return 0;
}
